var tmrFormatoTabla,tmrDatePicker,tmrfotosreportes,tmrCargaHora,tmrSeguridad,tmrPuertaStatus,url="",map,darection;let arrInvitadoWhats=[],arrInvitadoMail=[],posLatLng="",selCalendarioInicio="",selCalendarioFin="";window.onload=function(){tmrPuertaStatus=setInterval(getPuertaStatus,1E3);tmrCargaHora=setInterval(lblhora,1E3);tmrSeguridad=setInterval(seguridadjs,5E3);cargaWeather();paypal();getUbicacion()};
function getUbicacion(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(setLatLng)}function setLatLng(a){posLatLng=a.coords.latitude+","+a.coords.longitude}
function cargaWeather(){$.ajax({dataType:"json",url:"select.php?tipo=7",success:function(a){for(let b=0;b<a.length;b++)if(arrLatLng=a[b].ubicacion.split(","),1<arrLatLng.length){let c=arrLatLng[0].trim(),f=arrLatLng[1].trim();$.ajax({dataType:"json",url:"https://api.openweathermap.org/data/2.5/weather?lat="+c+"&lon="+f+"&appid=b090d3c9bcc07d471a8a5f4491d3acac&units=metric",success:function(g){_("lbltemperatura_"+a[b].idestacion).innerText=Math.round(g.main.temp);_("lblciudadtemperatura_"+a[b].idestacion).innerText=
g.name;_("icontemp_"+a[b].idestacion).src="https://openweathermap.org/img/wn/"+g.weather[0].icon+".png"}})}}})}async function seguridadjs(){const a=await getCookie("k");$.ajax({dataType:"json",url:"../common_files/clases/seguridad_main_js.php",type:"post",data:{k:a},success:function(b){0<b.logout&&(location.href="../login.php")}})}
function getCookie(a){a+="=";let b=decodeURIComponent(document.cookie).split(";");for(let c=0;c<b.length;c++){let f=b[c];for(;" "==f.charAt(0);)f=f.substring(1);if(0==f.indexOf(a))return f.substring(a.length,f.length)}return""}
function lblhora(){var a=new Date,b="Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre".split(" "),c="Domingo Lunes Martes Miercoles Jueves Viernes Sabado".split(" ");_("lblfecha").innerHTML=c[a.getDay()]+" "+a.getDate()+" de "+b[a.getMonth()]+" del "+a.getFullYear()+"  "+(10>a.getHours()?"0"+a.getHours():a.getHours())+":"+(10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes())+":"+(10>a.getSeconds()?"0"+a.getSeconds():a.getSeconds());_("txtHora").value=c[a.getDay()]+
" "+a.getDate()+" de "+b[a.getMonth()]+" del "+a.getFullYear()+"  "+(10>a.getHours()?"0"+a.getHours():a.getHours())+":"+(10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes())+":"+(10>a.getSeconds()?"0"+a.getSeconds():a.getSeconds())}
function formatoTabla(a,b,c,f,g,h,d,e=!0){var l=document.getElementsByClassName("table");for(i=0;i<l.length;i++)l[i].getAttribute("id").match(/lst.*/)&&($("table#"+l[i].getAttribute("id")).DataTable({stateSave:!0,paging:a,retrieve:b,lengthChange:c,searching:f,ordering:g,info:h,autoWidth:d,dom:"Bfrtip",buttons:e?["csvHtml5","pdfHtml5","copyHtml5"]:[],language:{buttons:{copy:"Copiar",csv:"Excel CSV",pdf:"PDF"},search:"Buscar:",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",emptyTable:"No se encontraron registros",
infoEmpty:"No se encontraron registros",zeroRecords:"No se encontraron registros",paginate:{previous:" < ",next:" > "}}}),clearInterval(tmrFormatoTabla));clearInterval(tmrFormatoTabla)}function validateEmail(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())}
function agregaInvitado(){if(""!==_("txtemail").value)if(validateEmail(_("txtemail").value))_("txtemail");else return Swal.fire("Error!","Error, correo electr\u00f3nico incorrecto !","error"),!1;if(""!==_("txtwhatsapp").value)if(10===_("txtwhatsapp").value.length)_("txtwhatsapp");else return Swal.fire("Error!","Error, n\u00famero de whatsapp incorrecto !","error"),!1;if(datoinvitadorem(Base64.encode(_("txtnombrecontacto").value),!0)){json_Contact_Api.push({nombre:_("txtnombrecontacto").value,correo:_("txtemail").value,
telefono:_("cbopais").value+""+_("txtwhatsapp").value});let a='<div id="tmp_'+Base64.encode(_("txtnombrecontacto").value)+'" onclick="datoinvitadorem(\''+Base64.encode(_("txtnombrecontacto").value)+'\',false);" style="padding: 8px;"><div class="vue-treeselect__multi-value-item"><span class="vue-treeselect__multi-value-label">'+_("txtnombrecontacto").value+"&nbsp;&nbsp;W: "+_("cbopais").value+_("txtwhatsapp").value+"&nbsp;&nbsp;@: "+_("txtemail").value+'</span><span class="vue-treeselect__icon vue-treeselect__value-remove"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 348.333 348.333"><path d="M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"></path></svg></span></div></div>';
$("#divinvitados").append(a);_("txtwhatsapp").value="";_("txtemail").value="";_("txtnombrecontacto").value=""}else Swal.fire("Error!","Error, invitado ya esta en la lista !","error")}function datoinvitadorem(a,b){for(let c=0;c<json_Contact_Api.length;c++)if(Base64.encode(json_Contact_Api[c].nombre)===a){if(b)return!1;json_Contact_Api.splice(c,1);_("tmp_"+a).style="display:none;";break}return!0}
function guardar_evento(a){if(0===json_Contact_Api.length)return Swal.fire("Error!","Error, Ning\u00fan invitado para el evento.","error"),!1;if(""===_("txtnombre").value)return Swal.fire("Error!","Error, falta el nomnbre del evento.","error"),_("txtnombre").focus(),!1;$.ajax({type:"POST",url:"select.php?tipo=8",dataType:"json",data:{idestacion:_("txtidestacioninvitados").value,nombre:_("txtnombre").value,fecha:_("txtdtfecha").value,hora:_("txtdthora").value,json_invitados:JSON.stringify(json_Contact_Api)}}).done(function(b){_("divinvitados_1").style=
"display: none;";_("divinvitados_2").style="display: inline;";var c=_("lstlistainvitados");for(let f=0;f<b.length;f++){let g=c.insertRow(c.getElementsByTagName("tr").length);cell=g.insertCell(0);cell.innerHTML=b[f].nombre;cell=g.insertCell(1);cell.innerHTML=b[f].correo;cell=g.insertCell(2);cell.innerHTML=b[f].telefono;cell=g.insertCell(3);cell.innerHTML='<button class="btn btn-gray-light" onclick="enviaWhatsInvitado(\''+Base64.encode(b[f].codigo)+"','"+b[f].telefono+'\');" title="Enviar whatsapp" id="btncontactos"><i class="fab fa-whatsapp text-success fa-2x"></i></button>'}})}
function enviaWhatsInvitado(a,b){a=a.replaceAll("=","");a=encodeURI("https://wa.me/"+b+"?text=Hey !, entra a esta p\u00e1gina para ver el c\u00f3digo de acceso. https://smartdoor.mx?v="+a);window.open(a,"_blank")}function valorListaChk(a,b){var c=[];$("#"+a).DataTable().rows().nodes().to$().find('input[type="checkbox"]').each(function(){this.checked&&(b?this.checked=!1:c.push($(this).val()))});a="";return a=c.join(",")}function _(a){return document.getElementById(a)}
function uploadFile(a,b,c){var f=_(c).files.length;if(0===f)Swal.fire("Error!","Error, debe seleccionar al menos un archivo !","error");else for(i=0;i<f;i++){var g=_(c).files[i],h=new FormData;h.append(c,g);h.append(a,1);h.append("idusuario",b);g=new XMLHttpRequest;g.open("POST","subir_archivos.php");g.send(h)}}
function setDatePicker(){_("datepicker")&&($("#datepicker").datepicker({autoclose:!0,todayHighlight:!0,format:"yyyy-mm-dd"}),$("#datepicker").datepicker().on("changeDate",function(a){getPrecios(a.format("yyyy-mm-dd"));_("lblfacturafecha").innerHTML=a.format("yyyy-mm-dd");_("txtfacturafecha").value=a.format("yyyy-mm-dd")}),clearInterval(tmrDatePicker))}
function formatMoneda(a,b,c,f){b=isNaN(b=Math.abs(b))?2:b;c=void 0===c?".":c;f=void 0===f?",":f;var g=0>a?"-":"",h=String(parseInt(a=Math.abs(Number(a)||0).toFixed(b))),d=3<(d=h.length)?d%3:0;return g+(d?h.substr(0,d)+f:"")+h.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+f)+(b?c+Math.abs(a-h).toFixed(b).slice(2):"")}function carga_camara(){Webcam.set({width:640,height:480,image_format:"png",jpeg_quality:100});Webcam.attach("#camara")}
function take_snapshot(){Webcam.snap(function(a){_("camara").innerHTML='<img id="imgfoto_identificacion" src="'+a+'"/>';_("imgavatar").src=a;guardar_imagen_camara()})}function guardar_imagen_camara(){var a=_("imgfoto_identificacion").src;$.ajax({type:"POST",url:"subir_archivos.php",data:{foto_identidad:1,imagen:a}}).done(function(b){_("lblStatus").innerHTML="Im&aacute;gen guardada.";_("divReiniciaCamara").style="display: inline"})}function pagos_invitados(){return!1}
function invitar_est_selec(a,b){_("txtidestacioninvitados").value=a;_("divinvitados_1").style="display:inline;";_("divinvitados_0").style="display:none;";_("txtnombre").focus();$.ajax({type:"POST",url:"select.php?tipo=9",dataType:"json",data:{idestacion:a,idusuario:b}}).done(function(c){let f=_("tblhistorico");for(let g=0;g<c.length;g++){let h=f.insertRow(f.getElementsByTagName("tr").length);h.onclick=function(d){return function(){for(let e=0;e<d.length;e++)if(datoinvitadorem(Base64.encode(d[e].nombre),
!0)){json_Contact_Api.push({nombre:d[e].nombre,correo:d[e].email,telefono:10===d[e].telefono.length?"52"+d[e].telefono:d[e].telefono});let l='<div id="tmp_'+Base64.encode(d[e].nombre)+'" onclick="datoinvitadorem(\''+Base64.encode(d[e].nombre)+'\',false);" style="padding: 8px;"><div class="vue-treeselect__multi-value-item"><span class="vue-treeselect__multi-value-label">'+d[e].nombre+"&nbsp;&nbsp;W: "+(10===d[e].telefono.length?"52"+d[e].telefono:d[e].telefono)+"&nbsp;&nbsp;@: "+d[e].email+'</span><span class="vue-treeselect__icon vue-treeselect__value-remove"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 348.333 348.333"><path d="M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"></path></svg></span></div></div>';
$("#divinvitados").append(l)}}}(c[g].invitados);cell=h.insertCell(0);cell.innerHTML=c[g].evento;cell=h.insertCell(1);cell.innerHTML=c[g].fecha+" "+c[g].hora;cell=h.insertCell(2);cell.innerHTML=strInvitados(c[g].invitados)}setTimeout(function(){formatoTabla(!0,!0,!1,!1,!1,!0,!0)},500)})}function strInvitados(a){let b="";for(let c=0;c<a.length;c++)""!==b?b+=", ":b+="",b+=a[c].nombre;return b}
function cambiaavatar(a,b,c,f){_(f).onchange=function(g){g=(g.target||window.event.srcElement).files;if(FileReader&&g&&g.length){var h=new FileReader;h.onload=function(){_(a).src=h.result;uploadFile(b,c,f)};h.readAsDataURL(g[0])}}}
function getGrafuso(a){ajaxpage("../common_files/cargando.html","contenido");$.ajax({url:"inicio_estacion.php"}).done(function(b){_("contenido").innerHTML=b;$.ajax({type:"POST",url:"select.php?tipo=5",dataType:"json",data:{id:a}}).done(function(c){c={chart:{type:"bar",height:350},series:[{name:c.meses[1],data:c.valores},{name:c.meses[0],data:c.valores2}],xaxis:{categories:c.categorias},colors:["#E91E63","#dedddd"],dataLabels:{enabled:!0,offsetX:-6,style:{fontSize:"12px",colors:["#fff","#020202"]}},
stroke:{show:!0,width:1,colors:["#fff"]},tooltip:{followCursor:!0,shared:!0,intersect:!1},plotOptions:{bar:{horizontal:!0,borderRadius:10,dataLabels:{position:"top"}}}};_("divgrafuso").innerHTML="";(new ApexCharts(_("divgrafuso"),c)).render()});$.ajax({type:"GET",url:"select.php?tipo=19",dataType:"json",data:{id:a}}).done(function(c){c={chart:{type:"bar",height:350},series:[{name:c.categorias,data:c.valores}],xaxis:{categories:c.categorias},colors:["#E91E63","#dedddd"],stroke:{show:!0,width:1,colors:["#fff"]},
tooltip:{followCursor:!0,shared:!0,intersect:!1},plotOptions:{bar:{borderRadius:10,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(f){return f},offsetY:-20,style:{fontSize:"12px",colors:["#304758"]}}};_("divgrafhora").innerHTML="";(new ApexCharts(_("divgrafhora"),c)).render()})})}
function descargarQr(a){var b=document.createElement("canvas");b.width=_("imgqr").width;b.height=_("imgqr").height;b.getContext("2d").drawImage(_("imgqr"),0,0);b=b.toDataURL("image/png");var c=document.createElement("a");c.href=b;c.download=Base64.decode(a)+".png";c.click()}
function valida_horarios(){let a=!0;""===_("dtlunesinicio").value&&(a=!1);""===_("dtlunesfin").value&&(a=!1);""===_("dtmartesinicio").value&&(a=!1);""===_("dtmartesfin").value&&(a=!1);""===_("dtmiercolesinicio").value&&(a=!1);""===_("dtmiercolesfin").value&&(a=!1);""===_("dtjuevesinicio").value&&(a=!1);""===_("dtjuevesfin").value&&(a=!1);""===_("dtviernesinicio").value&&(a=!1);""===_("dtviernesfin").value&&(a=!1);""===_("dtsabadoinicio").value&&(a=!1);""===_("dtsabadofin").value&&(a=!1);""===_("dtdomingoinicio").value&&
(a=!1);""===_("dtdomingofin").value&&(a=!1);a&&(_("btnGuardar").disabled=!1)}
function guardar_horario(){$.ajax({url:"select.php?tipo=10",type:"post",data:{idestacion:Base64.encode(_("cboestacionhorario").value),lunes:_("dtlunesinicio").value+","+_("dtlunesfin").value,martes:_("dtmartesinicio").value+","+_("dtmartesfin").value,miercoles:_("dtmiercolesinicio").value+","+_("dtmiercolesfin").value,jueves:_("dtjuevesinicio").value+","+_("dtjuevesfin").value,viernes:_("dtviernesinicio").value+","+_("dtviernesfin").value,sabado:_("dtsabadoinicio").value+","+_("dtsabadofin").value,
domingo:_("dtdomingoinicio").value+","+_("dtdomingofin").value},success:function(a){menu_horarios()}})}
function paypal(){$(".paypal-button-container").each(function(){this.innerHTML="";let a=this.id.split("paypal-")[1],b=_(a+"_plan_precio").value,c=_(a+"_plan_desc").value,f=_(a+"_plan_nombre").value,g=_(a+"_sku_smartdoor").value,h=0;h=1===Number(_(a+"_visitas").value)?_("cantvisitas").value:1===Number(_(a+"_plan_pago_x_usuario").value)?Number(_(a+"_usuarios").value):1;paypal_sdk.Buttons({locale:"es_MX",createOrder:function(d,e){return e.order.create({purchase_units:[{amount:{value:b*h,currency_code:"MXN",
breakdown:{item_total:{currency_code:"MXN",value:b*h}}},items:[{name:f,unit_amount:{currency_code:"MXN",value:b},sku:g,quantity:h,description:c}]}]})},onApprove:function(d,e){return e.order.capture().then(function(l){"COMPLETED"===l.status&&$.ajax({type:"POST",url:"select.php?tipo=13",data:{idestacion:a,idusuario:g.split("_")[1],monto:b*h,status:l.status,sku:g,cantidad:h,paypal_json:JSON.stringify(l)}}).done(function(k){gtag("event","purchase",{currency:"MXN",transaction_id:l.id,value:b*h,items:[{item_id:g,
item_name:f,currency:"MXN",price:b,quantity:h}]});1===Number(_(a+"_visitas").value)?menu_invitar():menu_inicio()})})}}).render(this)})}
function selecPlanServicio(a,b,c,f,g){$(".lblselecplan").css("display","none");_("lblselec"+a).style="display:inline;";$(".planservicio").addClass("elevation-5");_(b+"_plan_precio").value=Base64.decode(c);_(b+"_plan_desc").value=Base64.decode(f);_(b+"_plan_nombre").value=Base64.decode(g);a=b+"_"+_(b+"_sku_smartdoor").value.split("_")[1]+"_idplan_"+a+"_"+_(b+"_sku_smartdoor").value.split("_")[4];_(b+"_sku_smartdoor").value=a;1===Number(_(b+"_plan_pago_x_usuario").value)?_("divTotalPlan").innerHTML=
'<label class="text-danger">$ '+formatMoneda(Base64.decode(c)*Number(_(b+"_usuarios").value),2)+'</label><br> <label class="text-sm text-gray">( '+_(b+"_usuarios").value+" Usuarios activos * $"+formatMoneda(Base64.decode(c),2)+" )</label>":_("divTotalPlan").innerHTML='<label class="text-danger">$ '+formatMoneda(Base64.decode(c),2)+"</label>";paypal()}
async function getPlanesServicio(a,b,c){let f=0,g="",h="";await $.ajax({url:"select.php?tipo=14",data:{tiposervicio:a},type:"post",dataType:"json",success:function(d){_("divplanesservicio").innerHTML="";for(var e=0;e<d.length;e++){Number(d[e].idplan)===Number(b)&&(f=Base64.encode(d[e].monto),g=Base64.encode(d[e].descripcion),h=Base64.encode(d[e].nombre));var l='<div class="card card-default elevation-5 planservicio" onclick="selecPlanServicio('+d[e].idplan+",'"+c+"','"+Base64.encode(d[e].monto)+"','"+
Base64.encode(d[e].descripcion)+"','"+Base64.encode(d[e].nombre)+'\');$(this).toggleClass(\'elevation-5\');">\n                        <div class="card-header with-border">\n                            <h3 class="card-title">'+d[e].nombre+" - "+d[e].descripcion+'</h3>\n                        </div>\n                        <div class="card-body">',k=d[e].usuarios;-1===Number(d[e].usuarios)&&(k="Ilimitado");var m=d[e].administradores;-1===Number(d[e].administradores)&&(m="Ilimitado");k='<i class="fa fa-check text-success"></i> &nbsp;&nbsp; Usuario(s): <label>'+
k+'</label><br><i class="fa fa-check text-success"></i> &nbsp;&nbsp; Administrador(es): <label>'+m+"</label><br>";k=-1===Number(d[e].empleados)?k+'<i class="fa fa-check text-success"></i> &nbsp;&nbsp; Empleado(s): <label>Ilimitado</label><br>':0<Number(d[e].empleados)?k+('<i class="fa fa-check text-success"></i> &nbsp;&nbsp; Empleado(s): <label>'+d[e].empleados+"</label><br>"):k+'<i class="fa fa-times text-danger"></i> &nbsp;&nbsp; Agregar empleados.<br>';k=-1===Number(d[e].visitas)?k+'<i class="fa fa-check text-success"></i> &nbsp;&nbsp; Visitas: <label>Ilimitado</label><br>':
0<Number(d[e].visitas)?k+('<i class="fa fa-check text-success"></i> &nbsp;&nbsp; Visitas: <label>'+d[e].visitas+"</label><br>"):k+'<i class="fa fa-times text-danger"></i> &nbsp;&nbsp; Visitas.<br>';m="";1===Number(d[e].pago_x_usuario)&&(m="por usuario");var n="Anuales";12!==Number(d[e].periodo)&&(n="Cada "+d[e].periodo+" mese(s)");m='</div><div class="card-footer text-right"><label class="text-success float-left lblselecplan" id="lblselec'+d[e].idplan+'" style="display: none;">Seleccionado</label><label class="text-gray">$'+
d[e].monto+" MXN "+m+" "+n+" </label></div></div><br><br>";$("#divplanesservicio").append(l+k+m)}selecPlanServicio(b,c,f,g,h)}})}; //# sourceMappingURL=app.js.map
