window.onload=function(){""!==token&&""!==nombre?1===bloqueado?swal.fire({title:nombre,text:"Usuario bloqueado por administrador.",icon:"error"}).then(b=>{window.location.replace("index.php")}):abrepuerta(Base64.encode(token),Base64.encode(nombre)):window.location.replace("index.php")};
function abrepuerta(b,a){b=Base64.decode(b);a=Base64.decode(a);$.ajax({url:"desktop/select.php?tipo=2&codigo="+b,success:function(c){c=JSON.parse(c);c=c.estatus;switch(Number(c)){case 0:$.ajax({url:"desktop/select.php?tipo=1&codigo="+b+"&pos=nfc",success:function(d){let e=Number(d);isNaN(e)?swal.fire({title:a,text:d+" a hecho una apertura, debe esperar un momento para ejecutar de nuevo.",icon:"error"}).then(f=>{window.location.replace("index.php")}):Swal.fire({title:"Esperando a "+a,html:"Espere mientras recibimos confirmaci\u00f3n de la puerta, se cancela en: <b>30</b>",
timer:3E4,timerProgressBar:!0,didOpen:()=>{Swal.showLoading();const f=Swal.getHtmlContainer().querySelector("b");timerInterval=setInterval(()=>{f.textContent=Math.round(Swal.getTimerLeft()/1E3)},100);$.ajax({url:"select.php?tipo=15&idregistro="+e,success:function(g){1===Number(g)?(swal.close(),swal.fire({title:a,text:"Hecho, se abrio la puerta !",icon:"success"}).then(h=>{window.location.replace("index.php")})):(swal.close(),swal.fire({title:a,text:"No se a podido abrir la puerta, operaci\u00f3n cancelada !",
icon:"error"}).then(h=>{window.location.replace("index.php")}));clearInterval(timerInterval)}})},allowOutsideClick:()=>!Swal.isLoading()})}});break;case 1:swal.fire({title:a,text:"La puerta se encuentra en movimiento, intenta en un minuto.",icon:"error"}).then(d=>{window.location.replace("index.php")});break;case 2:swal.fire({title:a,text:"La puerta se encuentra sin conexion WIFI.",icon:"error"}).then(d=>{window.location.replace("index.php")})}}})};
